{% extends "layouts/public_base.html" %}
{% load static %}

{% block content %}
  <section class="kv-stack">
    <div class="kv-page-header">
      <div>
        <h1 class="kv-title">Memes</h1>
        <p class="kv-subtitle">Nur gepr√ºfte Memes. Neueste zuerst.</p>
      </div>
      <a href="{% url 'memes:upload' %}" class="kv-btn kv-btn-primary">Meme hochladen</a>
    </div>

    <div id="meme-grid" class="meme-grid" aria-live="polite">
      {% if memes %}
        {% for meme in memes %}
          <article
            class="meme-card"
            data-meme-id="{{ meme.id }}"
            data-meme-title="{{ meme.title|default_if_none:'' }}"
            data-meme-image="{{ meme.image_url }}"
            data-like-count="{{ meme.like_count }}"
            data-liked="{% if meme.id in liked_ids %}true{% else %}false{% endif %}"
          >
            <button class="meme-card__button" type="button" data-meme-open>
              {% if meme.image_url %}
                <img class="meme-card__image" src="{{ meme.image_url }}" alt="{{ meme.title|default:'Meme' }}">
              {% endif %}
            </button>
            <div class="meme-card__body">
              <button class="meme-card__title-button" type="button" data-meme-open>
                {% if meme.title %}
                  {{ meme.title }}
                {% else %}
                  Meme #{{ meme.id }}
                {% endif %}
              </button>
              <div class="meme-like">
                <button class="meme-like__button" type="button" {% if meme.id in liked_ids %}disabled{% endif %}>
                  {% if meme.id in liked_ids %}‚ù§Ô∏è Geliked{% else %}ü§ç Like{% endif %}
                </button>
                <span class="meme-like__count">{{ meme.like_count }} Likes</span>
              </div>
            </div>
          </article>
        {% endfor %}
      {% else %}
        <div class="kv-card">
          <p class="kv-subtitle">Noch keine Memes freigegeben.</p>
        </div>
      {% endif %}
    </div>
  </section>

  <div id="meme-modal" class="meme-modal" aria-hidden="true">
    <div class="meme-modal__backdrop" data-modal-close></div>
    <div class="meme-modal__content" role="dialog" aria-modal="true">
      <button class="meme-modal__close" type="button" aria-label="Schliessen" data-modal-close>
        √ó
      </button>
      <button class="meme-modal__nav meme-modal__nav--prev" type="button" aria-label="Vorheriges Meme" data-modal-prev>
        ‚Äπ
      </button>
      <button class="meme-modal__nav meme-modal__nav--next" type="button" aria-label="N√§chstes Meme" data-modal-next>
        ‚Ä∫
      </button>
      <img id="meme-modal-image" src="" alt="">
      <div class="meme-modal__footer">
        <p id="meme-modal-title" class="meme-modal__title"></p>
        <div class="meme-like">
          <button id="meme-modal-like" class="meme-like__button" type="button"></button>
          <span id="meme-modal-count" class="meme-like__count"></span>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}

{% block extra_js %}
  <script src="{% static 'assets/memes.js' %}"></script>
{% endblock extra_js %}
